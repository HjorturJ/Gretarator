<!DOCTYPE html>
<html>
    <head>
        <title>Gretarnator</title>
        <link rel="icon" href="https://i.imgur.com/PrB1lBW.png">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <style>
            .center {
                margin: auto;
                width: 60%;
                padding: 100px;
                text-align: center;
            }
            .huge {
                font-size: 500%;
            }
        </style>
    </head>
    <body>
        <div class="center">
            <h1 id="random" class="huge">Grétar</h1>
            <p id="descr">The OG</p>
            <button type="button" onclick="getRandomName()">Random Nickname!</button>
        </div>
        <div class="center">
            <img src="https://i.imgur.com/PrB1lBW.png" alt="GreBoi">
        </div>

        <script>
            //TODO: Change this ugly stuff to a fetch async await block
            var nicknames;
            function getAllNicks() {
                var xhttp = new XMLHttpRequest();
                xhttp.open("GET", "/api/nicknames", true);
                xhttp.setRequestHeader('Ping-Other', 'pingpong');
                xhttp.setRequestHeader('Content-Type', 'application/xml');
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        nicknames = JSON.parse(this.responseText);
                    }
                };
                xhttp.send();
            };

            //Cache full nickname list locally so we dont make the random request as fast as the users can press the button lol
            getAllNicks(); 

            var lastNick = "Grétar";
            function getRandomName() {
                var newNick = nicknames[Math.floor(Math.random()*nicknames.length)];
                if(newNick.nickname == lastNick) {
                    //Twice as less likely to get the same nickname twice, fuck it, too lazy to circular index loop
                    newNick = nicknames[Math.floor(Math.random()*nicknames.length)];
                }
                document.getElementById("random").innerText = newNick.nickname;
                if(newNick.description) {
                    document.getElementById("descr").innerText = newNick.description;
                }
                else {
                    document.getElementById("descr").innerText = "No description";
                }
                lastNick = newNick.nickname;
            }
        </script>
    </body>
</html>